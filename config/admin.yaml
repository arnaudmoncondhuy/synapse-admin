services:
    _defaults:
        autowire: true
        autoconfigure: true

    # ── Controllers Admin V2 (autoloading récursif) ───────────────────────────
    # Couvre PlaceholderController + tous les sous-dossiers :
    # Intelligence/, Conversation/, Memoire/, Usage/, etc.
    # Tout nouveau contrôleur dans AdminV2/ sera automatiquement enregistré.
    ArnaudMoncondhuy\SynapseAdmin\AdminV2\Controller\:
        resource: '../src/AdminV2/Controller/'
        tags: ['controller.service_arguments']

    # ── Twig Integration ──────────────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseAdmin\Infrastructure\Twig\SynapseRuntime:
        tags: ['twig.runtime']

    ArnaudMoncondhuy\SynapseAdmin\Infrastructure\Twig\SynapseTwigExtension:
        tags: ['twig.extension']

    # Les contrôleurs V1 seront supprimés après validation du déplacement des services Twig.

    # ── Accounting (Admin feature) ────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseCore\Core\Accounting\TokenAccountingService: ~

    # ── Debug Logging (Admin override) ───────────────────────────────────────
    # Quand l'admin est activé, utilise DoctrineAdminLogger (stockage DB)
    # au lieu de MonologDebugLogger (logs filesystem)
    ArnaudMoncondhuy\SynapseCore\Storage\Logger\DoctrineAdminLogger:
        arguments:
            $em: '@doctrine.orm.entity_manager'
            $repository: '@ArnaudMoncondhuy\SynapseCore\Storage\Repository\SynapseDebugLogRepository'
        public: false

    ArnaudMoncondhuy\SynapseCore\Contract\SynapseDebugLoggerInterface:
        alias: ArnaudMoncondhuy\SynapseCore\Storage\Logger\DoctrineAdminLogger
