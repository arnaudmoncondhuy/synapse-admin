services:
    _defaults:
        autowire: true
        autoconfigure: true

    # ── Contrôleurs Administration (autoloading récursif) ─────────────────────
    # Couvre tous les sous-dossiers : Intelligence/, Conversation/, Memoire/, Usage/, etc.
    ArnaudMoncondhuy\SynapseAdmin\Admin\Controller\:
        resource: '../src/Admin/Controller/'
        tags: ['controller.service_arguments']

    # ── Twig Integration ──────────────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseAdmin\Infrastructure\Twig\SynapseRuntime:
        tags: ['twig.runtime']

    ArnaudMoncondhuy\SynapseAdmin\Infrastructure\Twig\SynapseTwigExtension:
        tags: ['twig.extension']

    # ── Accounting (Admin feature) ────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseCore\Core\Accounting\TokenAccountingService: ~

    # ── Debug Logging (Admin override) ───────────────────────────────────────
    # Quand l'admin est activé, utilise DoctrineAdminLogger (stockage DB)
    # au lieu de MonologDebugLogger (logs filesystem)
    ArnaudMoncondhuy\SynapseCore\Storage\Logger\DoctrineAdminLogger:
        arguments:
            $em: '@doctrine.orm.entity_manager'
            $repository: '@ArnaudMoncondhuy\SynapseCore\Storage\Repository\SynapseDebugLogRepository'
        public: false

    ArnaudMoncondhuy\SynapseCore\Contract\SynapseDebugLoggerInterface:
        alias: ArnaudMoncondhuy\SynapseCore\Storage\Logger\DoctrineAdminLogger
