{% extends '@Synapse/admin/layout/base.html.twig' %}

{% block admin_page_title %}
	{{ is_new ? 'Nouveau ton' : 'Ã‰diter : ' ~ tone.name }}
	| Intelligence | Synapse Administration Synapse
{% endblock %}

{% block admin_breadcrumb %}
	<span class="synapse-admin-topbar__breadcrumb-sep">â€º</span>
	<a href="#" class="synapse-admin-topbar__breadcrumb">Intelligence</a>
	<span class="synapse-admin-topbar__breadcrumb-sep">â€º</span>
	<a href="{{ path('synapse_admin_tones') }}" class="synapse-admin-topbar__breadcrumb">Tons de rÃ©ponse</a>
	<span class="synapse-admin-topbar__breadcrumb-sep">â€º</span>
	<span class="synapse-admin-topbar__current">{{ is_new ? 'Nouveau' : tone.name }}</span>
{% endblock %}

{% block admin_content %}

	<div class="synapse-admin-page-header">
		<div class="synapse-admin-page-header__info">
			<h1 class="synapse-admin-page-title">
				<span class="synapse-admin-page-title__icon synapse-admin-kpi__icon--primary">
					<i data-lucide="mic-2"></i>
				</span>
				{{ is_new ? 'Nouveau ton de rÃ©ponse' : 'Ã‰diter : ' ~ tone.name }}
			</h1>
			<p class="synapse-admin-page-subtitle">
				{{ is_new
				? 'CrÃ©ez un ton personnalisÃ© qui dÃ©finit le style de communication de l\'IA.'
				: 'Modifiez ce ton de rÃ©ponse. Les changements s\'appliquent immÃ©diatement aprÃ¨s sauvegarde.' }}
			</p>
		</div>
		<div class="synapse-admin-page-header__actions">
			<a href="{{ path('synapse_admin_tones') }}" class="synapse-admin-btn synapse-admin-btn--ghost synapse-admin-btn--sm">
				<i data-lucide="arrow-left"></i>
				Retour
			</a>
		</div>
	</div>

	<form method="post" action="{{ is_new ? path('synapse_admin_tones_new') : path('synapse_admin_tones_edit', {id: tone.id}) }}">

		<input type="hidden" name="_token" value="{{ csrf_token('synapse_tone_edit') }}">

		{# â”€â”€ Identification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
		<div class="synapse-admin-card synapse-admin-mb-lg">
			<div class="synapse-admin-card__header">
				<div class="synapse-admin-card__header-icon synapse-admin-kpi__icon--primary">
					<i data-lucide="tag"></i>
				</div>
				<div>
					<div class="synapse-admin-card__title">Identification</div>
					<div class="synapse-admin-card__subtitle">Nom, emoji et clÃ© technique</div>
				</div>
			</div>
			<div class="synapse-admin-card__body synapse-admin-card__body--compact">

				<div class="synapse-admin-grid synapse-admin-grid--3 synapse-admin-mb-md">

					<div class="synapse-admin-form-group">
						<label class="synapse-admin-label" for="tone-emoji">Emoji</label>
						<input type="text" id="tone-emoji" name="emoji" value="{{ tone.emoji }}"
							class="synapse-admin-input" placeholder="ðŸ§" maxlength="10">
					</div>

					<div class="synapse-admin-form-group" style="grid-column: span 2;">
						<label class="synapse-admin-label" for="tone-name">
							Nom affichÃ© <span class="synapse-admin-required">*</span>
						</label>
						<input type="text" id="tone-name" name="name" value="{{ tone.name }}"
							class="synapse-admin-input" required placeholder="Ex : L'Expert Technique">
					</div>

				</div>

				<div class="synapse-admin-form-group">
					<label class="synapse-admin-label" for="tone-key">
						ClÃ© technique (slug) <span class="synapse-admin-required">*</span>
						{% if tone.isBuiltin %}
							<span class="synapse-admin-badge synapse-admin-badge--neutral synapse-admin-ml-sm" data-synapse-admin-tooltip="La clÃ© d'un ton builtin ne peut pas Ãªtre modifiÃ©e">
								<i data-lucide="lock"></i>
								VerrouillÃ©e
							</span>
						{% endif %}
					</label>
					<input type="text" id="tone-key" name="key" value="{{ tone.key }}"
						class="synapse-admin-input synapse-admin-font-mono"
						{{ tone.isBuiltin ? 'readonly' : '' }}
						required placeholder="ex: expert_technique"
						pattern="[a-z0-9_]+" title="Lettres minuscules, chiffres et tirets bas uniquement">
					<p class="synapse-admin-help-text">UtilisÃ©e dans ChatService::ask(['tone' => '{{ tone.key ?: 'ma_cle' }}'])</p>
				</div>

			</div>
		</div>

		{# â”€â”€ Description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
		<div class="synapse-admin-card synapse-admin-mb-lg">
			<div class="synapse-admin-card__header">
				<div class="synapse-admin-card__header-icon synapse-admin-kpi__icon--primary">
					<i data-lucide="info"></i>
				</div>
				<div>
					<div class="synapse-admin-card__title">Description</div>
					<div class="synapse-admin-card__subtitle">Courte explication affichÃ©e dans le sÃ©lecteur</div>
				</div>
			</div>
			<div class="synapse-admin-card__body synapse-admin-card__body--compact">
				<div class="synapse-admin-form-group">
					<label class="synapse-admin-label" for="tone-description">Description <span class="synapse-admin-required">*</span></label>
					<textarea id="tone-description" name="description" class="synapse-admin-input synapse-admin-textarea" rows="2" required
						placeholder="Ex : Mode professionnel, direct et structurÃ©, sans fioritures.">{{ tone.description }}</textarea>
				</div>
			</div>
		</div>

		{# â”€â”€ Prompt systÃ¨me â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
		<div class="synapse-admin-card synapse-admin-mb-lg">
			<div class="synapse-admin-card__header">
				<div class="synapse-admin-card__header-icon synapse-admin-kpi__icon--primary">
					<i data-lucide="file-text"></i>
				</div>
				<div>
					<div class="synapse-admin-card__title">Prompt systÃ¨me</div>
					<div class="synapse-admin-card__subtitle">Instructions injectÃ©es dans le system prompt du LLM</div>
				</div>
			</div>
			<div class="synapse-admin-card__body synapse-admin-card__body--compact">

				<div class="synapse-admin-alert synapse-admin-alert--info synapse-admin-mb-md">
					<i data-lucide="info"></i>
					<span>Ces instructions sont ajoutÃ©es Ã  la fin du prompt systÃ¨me principal et s'appliquent <strong>uniquement au ton et au style</strong> â€” jamais au raisonnement ou aux contraintes techniques.</span>
				</div>

				<div class="synapse-admin-form-group">
					<label class="synapse-admin-label" for="tone-system-prompt">Instructions <span class="synapse-admin-required">*</span></label>
					<textarea id="tone-system-prompt" name="system_prompt" class="synapse-admin-input synapse-admin-textarea synapse-admin-font-mono" rows="8" required
						placeholder="TON: Professionnel, Direct. FORMAT: Structure hiÃ©rarchisÃ©e. INTERDIT: Humour, blabla. OBJECTIF: RÃ©ponse exploitable en minimum de temps.">{{ tone.systemPrompt }}</textarea>
				</div>

			</div>
		</div>

		{# â”€â”€ ParamÃ¨tres â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
		<div class="synapse-admin-card synapse-admin-mb-lg">
			<div class="synapse-admin-card__header">
				<div class="synapse-admin-card__header-icon synapse-admin-kpi__icon--primary">
					<i data-lucide="settings-2"></i>
				</div>
				<div>
					<div class="synapse-admin-card__title">ParamÃ¨tres</div>
					<div class="synapse-admin-card__subtitle">VisibilitÃ© et ordre d'affichage</div>
				</div>
			</div>
			<div class="synapse-admin-card__body synapse-admin-card__body--compact">

				<div class="synapse-admin-grid synapse-admin-grid--2">

					<div class="synapse-admin-form-group">
						<label class="synapse-admin-label" for="tone-sort-order">Ordre d'affichage</label>
						<input type="number" id="tone-sort-order" name="sort_order" value="{{ tone.sortOrder }}"
							class="synapse-admin-input" min="0" max="999" placeholder="0">
						<p class="synapse-admin-help-text">Plus petit = affichÃ© en premier. Les tons builtin apparaissent en tÃªte.</p>
					</div>

					<div class="synapse-admin-form-group">
						<div class="synapse-admin-label">VisibilitÃ©</div>
						<label class="synapse-admin-toggle">
							<input type="checkbox" name="is_active" id="tone-is-active" {{ tone.isActive ? 'checked' : '' }}>
							<span class="synapse-admin-toggle__slider"></span>
							<span class="synapse-admin-toggle__label">Activer ce ton (visible dans le sÃ©lecteur)</span>
						</label>
					</div>

				</div>

			</div>
		</div>

		{# â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
		<div class="synapse-admin-flex synapse-admin-gap-md synapse-admin-justify-end synapse-admin-mb-xl">
			<a href="{{ path('synapse_admin_tones') }}" class="synapse-admin-btn synapse-admin-btn--ghost">
				Annuler
			</a>
			<button type="submit" class="synapse-admin-btn synapse-admin-btn--primary">
				<i data-lucide="save"></i>
				{{ is_new ? 'CrÃ©er le ton' : 'Enregistrer' }}
			</button>
		</div>

	</form>

{% endblock %}
